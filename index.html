<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Tutor Pro - Highlight Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --bg-dark: #0F172A; --gold: #FACC15; --slate: #1E293B;
            --name-w: 90px; --fee-w: 50px;
            --holiday-bg: #581c87; --accent: #3B82F6;
            /* ألوان التمييز الجديدة */
            --pay-bg: #FFFBEB; /* خلفية ذهبية باهتة جداً */
            --pay-border: #D97706; /* إطار ذهبي غامق */
        }
        body { margin: 0; background: var(--bg-dark); color: white; font-family: 'Segoe UI', sans-serif; direction: ltr; font-size: 12px; }

        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 15px; background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(15px);
            position: sticky; top: 0; z-index: 1000; border-bottom: 2px solid var(--gold);
        }
        .logo-text { font-weight: 900; font-size: 18px; }
        .logo-text span { color: var(--gold); }

        .nav-btns { display: flex; gap: 8px; }
        .action-btn { background: var(--gold); color: #000; border: none; padding: 8px 12px; border-radius: 8px; font-weight: 800; cursor: pointer; font-size: 10px; display: flex; align-items: center; gap: 5px; }
        .pdf-btn { background: #ef4444; color: white; }

        .container { padding: 15px; }
        
        .teacher-box { display: flex; align-items: center; gap: 12px; background: var(--slate); padding: 12px; border-radius: 12px; border: 1px solid rgba(250, 204, 21, 0.3); margin-bottom: 15px; }
        .profile-img-container { position: relative; width: 60px; height: 60px; flex-shrink: 0; }
        .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; background: #334155; border: 2px solid var(--gold); }
        .add-img-btn { position: absolute; bottom: 0; right: 0; background: var(--gold); color: black; border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; font-size: 14px; border: 2px solid var(--bg-dark); z-index: 5; }

        .income-banner { background: linear-gradient(135deg, #FACC15 0%, #EAB308 100%); color: #000; padding: 12px; border-radius: 12px; text-align: center; margin-bottom: 15px; font-weight: 900; font-size: 16px; }

        .acc-table-wrapper { overflow-x: auto; background: #fff; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .acc-table { border-collapse: separate; border-spacing: 0; width: 100%; color: #1E293B; }
        .acc-table th { background: #1E293B; color: white; padding: 10px 4px; font-size: 9px; white-space: nowrap; position: sticky; top: 0; z-index: 30; }
        
        .sticky-name { 
            position: sticky; left: 0; z-index: 40; background: white !important; 
            border-right: 1px solid #e2e8f0 !important; width: var(--name-w); min-width: var(--name-w);
            color: #0F172A; font-weight: 900; font-size: 11px; padding: 10px 6px !important; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .sticky-fee { position: sticky; left: var(--name-w); z-index: 40; background: #f8fafc !important; border-right: 2px solid rgba(0,0,0,0.05) !important; font-weight: 900; width: var(--fee-w); text-align: center; font-size: 10px; }

        /* تجميل المربعات المتميزة */
        .box { 
            width: 26px; height: 26px; border-radius: 6px; border: 1px solid #CBD5E1; 
            background: white; cursor: pointer; display: inline-flex; align-items: center; 
            justify-content: center; font-weight: bold; font-size: 13px; margin: 0 auto; transition: 0.2s; 
        }

        /* المربع المميز (أسبوع الدفع) */
        .box.is-pay-week { 
            background: var(--pay-bg) !important; 
            border: 2px solid var(--pay-border) !important;
            box-shadow: inset 0 0 5px rgba(217, 119, 6, 0.2);
        }

        /* تداخل الحالات مع التميز */
        .box.status-paid { background: #10b981 !important; color: white !important; border-color: #059669 !important; } 
        .box.status-notpaid { background: #ef4444 !important; color: white !important; border-color: #dc2626 !important; } 

        tfoot td { background: #f8fafc !important; font-weight: 900; text-align: center; padding: 10px 2px; border-top: 2px solid #e2e8f0; position: sticky; bottom: 0; z-index: 30; }

        /* Sidebar & Modal */
        .sidebar, .modal { position: fixed; top: 0; left: -110%; width: 320px; height: 100%; background: white; z-index: 3000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); color: #1E293B; overflow-y: auto; box-shadow: 20px 0 50px rgba(0,0,0,0.5); }
        .sidebar.active, .modal.active { left: 0; }
        .sidebar-head { background: var(--slate); color: white; padding: 25px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--gold); }
        .sidebar-body { padding: 25px 20px; }
        .input-wrap { margin-bottom: 15px; }
        .input-wrap label { display: block; font-weight: 800; font-size: 10px; color: #64748B; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #F1F5F9; background: #F8FAF9; font-weight: 600; box-sizing: border-box; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(15, 23, 42, 0.8); backdrop-filter: blur(4px); display:none; z-index:2500; }
        .overlay.active { display:block; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<div class="sidebar" id="sidebar">
    <div class="sidebar-head"><h2>DASHBOARD</h2><button style="background:none; border:1px solid white; color:white; border-radius:20px; padding:5px 10px; cursor:pointer;" onclick="closeAll()">BACK</button></div>
    <div class="sidebar-body">
        <div class="input-wrap"><label>Student Name</label><input id="sName"></div>
        <div class="input-wrap"><label>Fee</label><input id="sPrice" type="number"></div>
        <div class="input-wrap"><label>Start Date</label><input id="sDate" type="date" value="2026-01-01"></div>
        <div class="input-wrap"><label>Cycle (Wks)</label><input id="sCycle" type="number" value="4"></div>
        <button class="action-btn" style="width:100%; background:var(--slate); color:white; padding:15px;" onclick="addStudent()">SAVE STUDENT</button>
    </div>
</div>

<header>
    <div class="logo-text">SMART<span>TUTOR</span></div>
    <div class="nav-btns">
        <button class="action-btn pdf-btn" onclick="exportPDF()">PDF</button>
        <button class="action-btn" onclick="toggleSidebar()">MENU</button>
    </div>
</header>

<div class="container" id="captureArea">
    <div class="teacher-box">
        <div class="profile-img-container">
            <img id="teacherImg" class="profile-img" src="https://via.placeholder.com/150">
            <label class="add-img-btn" for="tFile">+</label>
            <input type="file" id="tFile" hidden onchange="updateTeacherImg(this)">
        </div>
        <input id="teacherName" oninput="db.teacherName=this.value; save();" placeholder="Teacher Name" style="background:transparent; color:white; border:none; border-bottom:1px solid #444; font-size:16px; width:100%; font-weight:bold; outline:none;">
    </div>
    <div class="income-banner">ESTIMATED INCOME: <span id="totalIncome">0</span> SR</div>
    <div class="acc-table-wrapper">
        <table class="acc-table">
            <thead><tr id="accHeader"></tr></thead>
            <tbody id="accBody"></tbody>
        </table>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('t_pro_v30')) || { students: [], teacherName: '', teacherImg: 'https://via.placeholder.com/150' };

    function init() {
        document.getElementById('teacherName').value = db.teacherName;
        document.getElementById('teacherImg').src = db.teacherImg;
        render();
    }

    function render() {
        const head = document.getElementById('accHeader'), body = document.getElementById('accBody');
        let dates = []; 
        let dBase = new Date('2026-01-01');
        for(let i=0; i<25; i++) { dates.push(new Date(dBase)); dBase.setDate(dBase.getDate() + 7); }

        head.innerHTML = '<th class="sticky-name">Student</th><th class="sticky-fee">SR</th>';
        dates.forEach(d => head.innerHTML += `<th>${d.getDate()}/${d.getMonth()+1}</th>`);

        body.innerHTML = '';
        let total = 0;
        db.students.forEach((s, sIdx) => {
            total += Number(s.price || 0);
            let row = `<tr><td class="sticky-name" onclick="deleteStudent(${sIdx})">${s.name}</td><td class="sticky-fee">${s.price}</td>`;
            dates.forEach((d, dIdx) => {
                let sStart = new Date(s.startDate);
                let isPayWeek = false;
                if (d >= sStart) {
                    let diff = Math.floor((d - sStart) / (1000*60*60*24*7));
                    if (diff % (s.cycle || 4) === 0) isPayWeek = true;
                }
                
                let stat = (s.map && s.map[dIdx]) || 0;
                let content = stat === 1 ? '✓' : (stat === 2 ? '✕' : '');
                let cls = stat === 1 ? 'status-paid' : (stat === 2 ? 'status-notpaid' : '');
                let payCls = isPayWeek ? 'is-pay-week' : '';

                row += `<td><div class="box ${payCls} ${cls}" onclick="cycleStatus(${sIdx},${dIdx})">${content}</div></td>`;
            });
            body.innerHTML += row + '</tr>';
        });
        document.getElementById('totalIncome').innerText = total;
    }

    function cycleStatus(sIdx, dIdx) {
        let s = db.students[sIdx];
        if(!s.map) s.map = {};
        s.map[dIdx] = ((s.map[dIdx] || 0) + 1) % 3;
        save();
    }

    function addStudent() {
        const n = document.getElementById('sName').value;
        if(!n) return;
        db.students.push({ name: n, price: +document.getElementById('sPrice').value, startDate: document.getElementById('sDate').value, cycle: +document.getElementById('sCycle').value, map: {} });
        save(); closeAll();
    }

    function deleteStudent(idx) { if(confirm('Delete?')) { db.students.splice(idx, 1); save(); } }
    function save() { localStorage.setItem('t_pro_v30', JSON.stringify(db)); render(); }
    function toggleSidebar() { document.getElementById('sidebar').classList.add('active'); document.getElementById('overlay').classList.add('active'); }
    function closeAll() { document.querySelectorAll('.sidebar, .overlay').forEach(el => el.classList.remove('active')); }
    function updateTeacherImg(input) { if (input.files[0]) { let r = new FileReader(); r.onload = (e) => { db.teacherImg = e.target.result; save(); init(); }; r.readAsDataURL(input.files[0]); } }
    function exportPDF() { html2pdf().from(document.getElementById('captureArea')).save(); }

    window.onload = init;
</script>
</body>
</html>
