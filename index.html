<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Smart Tutor Pro | Ø§Ù„Ù…Ù†Ø¸Ù… Ø§Ù„Ø°ÙƒÙŠ</title>

<!-- =================== CSS =================== -->
<style>
:root {
  --bg-dark: #09090b; --card-bg: #141417; --text-main: #fafafa;
  --text-dim: #a1a1aa; --border: #27272a; --accent: #6366f1;
}

body {
  margin: 0; background: var(--bg-dark); color: var(--text-main);
  font-family: system-ui, -apple-system, sans-serif; direction: rtl;
  display: flex; justify-content: center;
}

.container { width: 100%; max-width: 480px; padding: 15px; box-sizing: border-box; }

header { padding: 20px 0; text-align: center; }
header h1 { font-size: 30px; margin: 0; background: linear-gradient(to right, #818cf8, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

.btn-print-top { background: #27272a; color: #fff; border: 1px solid var(--border); padding: 8px 16px; border-radius: 12px; margin-top: 15px; cursor: pointer; }

.card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
.card h3 { font-size: 14px; color: var(--accent); margin-bottom: 15px; }

.upload-area { width: 100%; height: 100px; border: 2px dashed var(--border); border-radius: 18px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; cursor: pointer; background: #000; overflow: hidden; }
.upload-area img { width: 100%; height: 100%; object-fit: cover; }

input, select { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid var(--border); border-radius: 12px; color: #fff; box-sizing: border-box; }
.row-inputs { display: flex; gap: 8px; margin-bottom: 10px; }

.palette-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-bottom: 15px; }
.color-swatch { aspect-ratio: 1; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
.color-swatch.active { border-color: #fff; transform: scale(1.1); }

button { border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.2s; }
.btn-primary { width: 100%; padding: 15px; background: var(--accent); color: white; }
.btn-success { width: 100%; padding: 15px; background: #10b981; color: white; }
.btn-outline { flex: 1; padding: 10px; background: transparent; border: 1px solid var(--accent); color: var(--accent); font-size: 11px; }

.student { display: flex; align-items: center; gap: 12px; padding: 12px; background: #1c1c20; border-radius: 18px; margin-bottom: 10px; border: 1px solid var(--border); }
.student-img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; background: #333; }
.student-info { flex: 1; }
.student-sub { font-size: 10px; color: var(--text-dim); margin-top: 3px; }

.day-row { display: flex; align-items: center; border-bottom: 1px solid var(--border); min-height: 60px; }
.day-label { width: 50px; font-size: 11px; font-weight: 800; color: var(--text-dim); text-align: center; }
.slots { flex: 1; display: flex; overflow-x: auto; gap: 8px; padding: 10px; scrollbar-width: none; }

.slot { flex-shrink: 0; min-width: 80px; padding: 8px; border-radius: 12px; color: white; text-align: center; font-size: 11px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
.slot .time { font-weight: 800; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 4px; }

.print-header { display: none; }

/* ğŸ–¨ï¸ Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© PDF */
@media print {
  body { background: white; color: black; }
  .no-print { display: none !important; }
  .print-header { display: block; text-align: center; color: black; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
  .container { max-width: 100%; }
  .card { border: 1px solid #ddd; background: white; box-shadow: none; color: black; }
  .day-label { color: black; }
  .slot { background: #f0f0f0 !important; color: black !important; border: 1px solid #ccc !important; box-shadow: none; }
  .slot .time { border-bottom: 1px solid #ccc; color: black; }
  .student { background: white !important; border: 1px solid #eee; color: black; page-break-inside: avoid; }
}

.animate-in { animation: fadeInUp 0.4s ease-out; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>

<body>
<div class="container">
<header class="no-print">
<h1>Smart Tutor</h1>
<p>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨</p>
<button onclick="window.print()" class="btn-print-top">ğŸ–¨ï¸ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ PDF</button>
</header>

<div class="print-header">
<h1>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨ - Smart Tutor</h1>
<p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: <span id="printDate"></span></p>
</div>

<section class="card no-print animate-in" id="inputSection">
<h3 id="formTitle">ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯</h3>
<div class="upload-area" onclick="document.getElementById('image').click()">
<input type="file" id="image" accept="image/*" hidden onchange="previewImage(this)">
<div id="imgPreview">ğŸ“¸ Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</div>
</div>

<div class="input-grid">
<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
<input id="phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
<input id="location" placeholder="Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ù„Ø­ÙŠ/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©)">
<input id="conditions" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ùˆ Ø¸Ø±ÙˆÙ Ø®Ø§ØµØ©">
</div>

<div class="color-picker-section">
<label>Ù„ÙˆÙ† Ø§Ù„ØªÙ…ÙŠØ² ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„:</label>
<div class="palette-grid" id="presetPalette"></div>
</div>

<div class="button-group">
<button id="submitBtn" onclick="addStudent()" class="btn-primary">Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</button>
<button id="cancelEditBtn" onclick="resetForm()" class="btn-cancel hidden">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
</div>
</section>

<section class="card no-print animate-in">
<h3>ğŸ¤– Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø°ÙƒÙŠ</h3>
<div class="row-inputs">
<button onclick="sortByLocation()" class="btn-outline">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ğŸ“</button>
<button onclick="sortByConditions()" class="btn-outline">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª âš¡</button>
</div>
</section>

<section class="card no-print animate-in">
<h3>â° Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
<select id="studentSelect"></select>
<div class="row-inputs">
<input type="time" id="time">
<select id="day">
<option value="Sat">Ø§Ù„Ø³Ø¨Øª</option><option value="Sun">Ø§Ù„Ø£Ø­Ø¯</option>
<option value="Mon">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option><option value="Tues">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
<option value="Wed">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option value="Thurs">Ø§Ù„Ø®Ù…ÙŠØ³</option>
</select>
</div>
<button onclick="addSchedule()" class="btn-success">ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙˆØ¹Ø¯</button>
</section>

<section class="time-grid card animate-in">
<h3>ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
<div class="day-row" data-day="Sat"><div class="day-label">Ø§Ù„Ø³Ø¨Øª</div><div class="slots"></div></div>
<div class="day-row" data-day="Sun"><div class="day-label">Ø§Ù„Ø£Ø­Ø¯</div><div class="slots"></div></div>
<div class="day-row" data-day="Mon"><div class="day-label">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div><div class="slots"></div></div>
<div class="day-row" data-day="Tues"><div class="day-label">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div><div class="slots"></div></div>
<div class="day-row" data-day="Wed"><div class="day-label">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div><div class="slots"></div></div>
<div class="day-row" data-day="Thurs"><div class="day-label">Ø§Ù„Ø®Ù…ÙŠØ³</div><div class="slots"></div></div>
</section>

<section class="card animate-in">
<h3>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
<div id="students"></div>
</section>
</div>

<!-- =================== JS =================== -->
<script>
let students = JSON.parse(localStorage.getItem('smartTutor_v4')) || [];
let activeColor = "#6366f1";
let currentImageData = "";
let editingId = null;

const modernColors = ["#6366f1", "#4f46e5", "#3b82f6", "#0ea5e9", "#06b6d4", "#2dd4bf", "#10b981", "#84cc16", "#eab308", "#f59e0b", "#f97316", "#ef4444", "#f43f5e", "#ec4899", "#d946ef", "#a855f7", "#8b5cf6", "#64748b"];

function initPalette() {
    const palette = document.getElementById('presetPalette');
    palette.innerHTML = '';
    modernColors.forEach(color => {
        const div = document.createElement('div');
        div.className = `color-swatch ${color === activeColor ? 'active' : ''}`;
        div.style.backgroundColor = color;
        div.onclick = () => {
            activeColor = color;
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            div.classList.add('active');
        };
        palette.appendChild(div);
    });
}

function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
            currentImageData = e.target.result;
            document.getElementById('imgPreview').innerHTML = `<img src="${currentImageData}">`;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function addStudent() {
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const location = document.getElementById('location').value.trim();
    const cond = document.getElementById('conditions').value.trim();

    if (!name) return alert("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨");

    if (editingId) {
        const s = students.find(x => x.id === editingId);
        Object.assign(s, { name, phone, location, conditions: cond, color: activeColor, image: currentImageData });
        editingId = null;
    } else {
        students.push({ id: Date.now(), name, phone, location, conditions: cond, color: activeColor, image: currentImageData, schedules: [] });
    }
    saveAndRender();
    resetForm();
}

function startEdit(id) {
    const s = students.find(x => x.id === id);
    editingId = id;
    document.getElementById('name').value = s.name;
    document.getElementById('phone').value = s.phone;
    document.getElementById('location').value = s.location;
    document.getElementById('conditions').value = s.conditions || "";
    activeColor = s.color;
    currentImageData = s.image;
    document.getElementById('imgPreview').innerHTML = s.image ? `<img src="${s.image}">` : "ğŸ“¸";
    document.getElementById('formTitle').innerText = "ğŸ“ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨";
    document.getElementById('submitBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
    document.getElementById('cancelEditBtn').classList.remove('hidden');
    initPalette();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function resetForm() {
    editingId = null;
    currentImageData = "";
    document.getElementById('name').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('location').value = '';
    document.getElementById('conditions').value = '';
    document.getElementById('imgPreview').innerHTML = "ğŸ“¸";
    document.getElementById('formTitle').innerText = "ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯";
    document.getElementById('submitBtn').innerText = "Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨";
    document.getElementById('cancelEditBtn').classList.add('hidden');
}

function sortByLocation() {
    students.sort((a, b) => (a.location || "").localeCompare(b.location || ""));
    render();
    alert("ØªÙ… ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ");
}

function sortByConditions() {
    students.sort((a, b) => (a.conditions || "").length - (b.conditions || "").length);
    render();
}

function addSchedule() {
    const id = +document.getElementById('studentSelect').value;
    const time = document.getElementById('time').value;
    const day = document.getElementById('day').value;
    if (!id || !time) return;
    const s = students.find(x => x.id === id);
    s.schedules.push({ day, time, id: Date.now() });
    s.schedules.sort((a, b) => a.time.localeCompare(b.time));
    saveAndRender();
}

function deleteStudent(id) {
    if (confirm("Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ")) {
        students = students.filter(x => x.id !== id);
        saveAndRender();
    }
}

function render() {
    document.getElementById('students').innerHTML = '';
    document.getElementById('studentSelect').innerHTML = '<option value="">Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨</option>';
    document.querySelectorAll('.slots').forEach(s => s.innerHTML = '');
    document.getElementById('printDate').innerText = new Date().toLocaleDateString('ar-EG');

    students.forEach(s => {
        document.getElementById('students').innerHTML += `
            <div class="student animate-in">
                <img class="student-img" src="${s.image || 'https://via.placeholder.com/50'}">
                <div class="student-info">
                    <div style="font-weight:700">${s.name}</div>
                    <div class="student-sub">ğŸ“ ${s.phone || '--'} | ğŸ“ ${s.location || '--'}</div>
                    <div class="student-sub" style="color:var(--accent)">ğŸ’¡ ${s.conditions || ''}</div>
                </div>
                <button onclick="startEdit(${s.id})" style="width:auto; background:none; color:var(--accent)">âœ</button>
                <button onclick="deleteStudent(${s.id})" style="width:auto; background:none; color:#ef4444">ğŸ—‘ï¸</button>
            </div>`;
        
        document.getElementById('studentSelect').innerHTML += `<option value="${s.id}">${s.name}</option>`;

        s.schedules.forEach(sc => {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.style.background = `linear-gradient(135deg, ${s.color}CC, ${s.color})`;
            slot.innerHTML = `<div class="time">${sc.time}</div><div>${s.name}</div>`;
            const cell = document.querySelector(`.day-row[data-day="${sc.day}"] .slots`);
            if (cell) cell.appendChild(slot);
        });
    });
}

function saveAndRender() {
    localStorage.setItem('smartTutor_v4', JSON.stringify(students));
    render();
}

initPalette();
render();
</script>

</body>
</html>
