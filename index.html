<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TutorFlow | Google Edition</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --bg: #F8F9FA; /* Google Light Gray */
            --card: #FFFFFF;
            --google-blue: #4285F4;
            --google-red: #EA4335;
            --google-yellow: #FBBC05;
            --google-green: #34A853;
            --text-main: #202124;
            --text-dim: #5f6368;
            --border: #dadce0;
        }
        
        body { 
            margin:0; background:var(--bg); color:var(--text-main); 
            font-family: 'Product Sans', 'Segoe UI', Roboto, sans-serif; 
            overflow-x: hidden; 
        }

        /* Sidebar - Google Style */
        .sidebar {
            position: fixed; top: 0; right: -100%; width: 85%; height: 100%;
            background: var(--card); border-left: 1px solid var(--border);
            z-index: 1000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px; box-sizing: border-box; overflow-y: auto;
            box-shadow: -8px 0 20px rgba(0,0,0,0.1);
        }
        .sidebar.active { right: 0; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); display:none; z-index:999; }
        .overlay.active { display:block; }

        /* Header */
        .main-content { padding: 15px; max-width: 500px; margin: auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        header h1 { 
            font-size: 22px; margin:0; font-weight: 500;
            display: flex; gap: 2px;
        }
        /* تلوين كلمة TutorFlow على طريقة جوجل */
        .logo-t { color: var(--google-blue); }
        .logo-u { color: var(--google-red); }
        .logo-t2 { color: var(--google-yellow); }
        .logo-o { color: var(--google-blue); }
        .logo-r { color: var(--google-green); }

        .menu-btn { 
            background: #fff; border: 1px solid var(--border); color: var(--text-dim);
            padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: 500;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: 0.2s;
        }
        .menu-btn:hover { background: #f1f3f4; }

        /* Timetable Grid - Colorful */
        .time-grid { display: flex; flex-direction: column; gap: 12px; }
        .day-row { 
            display: flex; align-items: stretch; background: var(--card); 
            border-radius: 12px; border: 1px solid var(--border); 
            overflow: hidden; min-height: 80px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .day-label { 
            width: 60px; display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 12px; color: #fff; border-left: 1px solid rgba(0,0,0,0.05);
        }

        /* ألوان الأيام */
        .row-sat .day-label { background: var(--google-blue); }
        .row-sun .day-label { background: var(--google-red); }
        .row-mon .day-label { background: var(--google-yellow); color: #000; }
        .row-tue .day-label { background: var(--google-green); }
        .row-wed .day-label { background: var(--google-blue); }
        .row-thu .day-label { background: var(--google-red); }

        .slots { flex: 1; display: flex; flex-direction: row-reverse; overflow-x: auto; gap: 10px; padding: 12px; }
        .slots::-webkit-scrollbar { display: none; }

        .slot { 
            flex-shrink: 0; min-width: 100px; padding: 8px; border-radius: 8px; 
            background: #f8f9fa; border: 1px solid var(--border); text-align: center;
        }
        .slot b { display: block; color: var(--google-blue); font-size: 13px; }
        .slot span { font-size: 11px; color: var(--text-main); font-weight: 500; }

        /* Inputs & Buttons */
        .section-title { font-size: 13px; font-weight: 500; color: var(--text-dim); margin: 20px 0 10px; }
        input, select { 
            width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; 
            border: 1px solid var(--border); background: #fff; font-size: 14px;
        }
        .primary-btn { 
            width: 100%; padding: 12px; border-radius: 8px; border: none; 
            background: var(--google-blue); color: white; font-weight: 500; cursor: pointer;
        }

        #map { width: 100%; height: 180px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 15px; }

        .payment-card { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; background: #fff; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 8px;
        }
        .payment-card.paid { border-right: 5px solid var(--google-green); }
        .pay-btn { background: var(--google-green); color: white; border: none; padding: 5px 12px; border-radius: 5px; font-size: 12px; cursor: pointer; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="sidebar" id="sidebar">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <h2 style="margin:0; font-size: 18px;">Control Panel</h2>
        <button onclick="toggleMenu()" style="background:none; border:none; font-size:24px; color:var(--text-dim); cursor:pointer;">&times;</button>
    </div>
    
    <div class="section-title">Students Locations</div>
    <div id="map"></div>

    <div class="section-title">New Student</div>
    <input id="stuName" placeholder="Student Name">
    <input id="stuPrice" type="number" placeholder="Fee (SR)">
    <button class="primary-btn" onclick="addStudent()">Add Student</button>

    <div class="section-title">Book a Class</div>
    <select id="stuSelect"></select>
    <input type="time" id="classTime">
    <select id="classDay">
        <option value="Sat">Saturday</option><option value="Sun">Sunday</option>
        <option value="Mon">Monday</option><option value="Tue">Tuesday</option>
        <option value="Wed">Wednesday</option><option value="Thu">Thursday</option>
    </select>
    <button class="primary-btn" style="background:var(--google-green)" onclick="addSchedule()">Save to Schedule</button>

    <div class="section-title">Payments</div>
    <div id="paymentList"></div>
</div>

<div class="main-content">
    <header>
        <h1>
            <span class="logo-t">T</span><span class="logo-u">u</span><span class="logo-t2">t</span><span class="logo-o">o</span><span class="logo-r">r</span>
            <span style="color:var(--text-dim); margin-right:4px;">Flow</span>
        </h1>
        <button class="menu-btn" onclick="toggleMenu()">Menu ☰</button>
    </header>

    <div class="time-grid" id="mainGrid"></div>
</div>

<script>
    let students = JSON.parse(localStorage.getItem('tutor_google_v1')) || [];
    const daysMap = {Sat:"SAT", Sun:"SUN", Mon:"MON", Tue:"TUE", Wed:"WED", Thu:"THU"};

    let map = L.map('map').setView([25.3833, 49.5833], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
    }

    function addStudent() {
        let name = document.getElementById('stuName').value;
        let price = document.getElementById('stuPrice').value;
        if(!name || !price) return;
        students.push({
            id: Date.now(), name, price: parseFloat(price), isPaid: false,
            lat: 25.3833 + (Math.random() * 0.04 - 0.02),
            lng: 49.5833 + (Math.random() * 0.04 - 0.02),
            schedules: []
        });
        save();
        document.getElementById('stuName').value = ""; document.getElementById('stuPrice').value = "";
    }

    function addSchedule() {
        let id = +document.getElementById('stuSelect').value;
        let time = document.getElementById('classTime').value;
        let day = document.getElementById('classDay').value;
        if(!id || !time) return;
        students.find(s => s.id === id).schedules.push({day, time});
        save();
        toggleMenu();
    }

    function togglePay(id) {
        let s = students.find(s => s.id === id);
        s.isPaid = !s.isPaid;
        save();
    }

    function save() {
        localStorage.setItem('tutor_google_v1', JSON.stringify(students));
        render();
    }

    function render() {
        const grid = document.getElementById('mainGrid');
        const select = document.getElementById('stuSelect');
        const pList = document.getElementById('paymentList');
        
        grid.innerHTML = ''; select.innerHTML = '<option value="">Choose Student</option>'; pList.innerHTML = '';
        map.eachLayer(l => { if(l instanceof L.Marker) map.removeLayer(l); });

        Object.keys(daysMap).forEach(d => {
            grid.innerHTML += `
                <div class="day-row row-${d.toLowerCase()}">
                    <div class="day-label">${daysMap[d]}</div>
                    <div class="slots" id="slot-${d}"></div>
                </div>`;
        });

        students.forEach(s => {
            select.innerHTML += `<option value="${s.id}">${s.name}</option>`;
            L.marker([s.lat, s.lng]).addTo(map).bindPopup(s.name);

            pList.innerHTML += `
                <div class="payment-card ${s.isPaid ? 'paid' : ''}">
                    <div><b>${s.name}</b><br><small>${s.price} SR</small></div>
                    <button class="pay-btn" onclick="togglePay(${s.id})">${s.isPaid ? 'Undo' : 'Collect'}</button>
                </div>`;

            s.schedules.forEach(sc => {
                const dayBox = document.getElementById(`slot-${sc.day}`);
                if(dayBox) {
                    dayBox.innerHTML += `
                        <div class="slot">
                            <b>${sc.time}</b>
                            <span>${s.name}</span>
                        </div>`;
                }
            });
        });
    }

    render();
</script>
</body>
</html>
