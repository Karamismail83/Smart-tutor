<!DOCTYPE html>
<html lang="en" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Tutor</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --bg: #F8F9FA; --card: #FFFFFF;
            --google-blue: #4285F4; --google-red: #EA4335;
            --google-yellow: #FBBC05; --google-green: #34A853;
            --text-main: #202124; --text-dim: #5f6368; --border: #dadce0;
        }
        
        body { margin:0; background:var(--bg); color:var(--text-main); font-family: 'Segoe UI', sans-serif; overflow-x: hidden; }

        /* Sidebar */
        .sidebar {
            position: fixed; top: 0; right: -100%; width: 85%; height: 100%;
            background: var(--card); border-left: 1px solid var(--border);
            z-index: 1000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px; box-sizing: border-box; overflow-y: auto;
        }
        .sidebar.active { right: 0; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); display:none; z-index:999; }
        .overlay.active { display:block; }

        /* Logo Correction - Forced LTR for the Name */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #fff; border-bottom: 1px solid var(--border); }
        
        .logo-container { 
            display: flex; 
            direction: ltr !important; /* ضمان ترتيب الحروف من اليسار لليمين */
            font-size: 26px; 
            font-weight: 700;
            gap: 0;
        }

        .c1 { color: var(--google-blue); } .c2 { color: var(--google-red); } 
        .c3 { color: var(--google-yellow); } .c4 { color: var(--google-green); } 
        .c5 { color: var(--google-blue); } .c6 { color: var(--google-red); } 
        .c7 { color: var(--google-yellow); } .c8 { color: var(--google-green); } 
        .c9 { color: var(--google-blue); } .c10 { color: var(--google-red); }
        .space { width: 8px; }

        /* Timetable Grid */
        .time-grid { padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        .day-row { display: flex; align-items: stretch; background: var(--card); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; min-height: 80px; }
        .day-label { width: 65px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 13px; color: #fff; }
        
        .row-sat .day-label { background: var(--google-blue); }
        .row-sun .day-label { background: var(--google-red); }
        .row-mon .day-label { background: var(--google-yellow); color: #000; }
        .row-tue .day-label { background: var(--google-green); }
        .row-wed .day-label { background: var(--google-blue); }
        .row-thu .day-label { background: var(--google-red); }

        .slots { flex: 1; display: flex; flex-direction: row-reverse; overflow-x: auto; gap: 10px; padding: 12px; }
        .slot { flex-shrink: 0; min-width: 110px; padding: 10px; border-radius: 12px; color: #fff; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .slot b { display: block; font-size: 14px; border-bottom: 1px solid rgba(255,255,255,0.2); margin-bottom: 4px; }

        /* Form Elements */
        .palette { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 10px 0; }
        .color-swatch { aspect-ratio: 1; border-radius: 50%; cursor: pointer; border: 3px solid transparent; }
        .color-swatch.active { border-color: #202124; transform: scale(1.1); }
        
        input, select, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 12px; border: 1px solid var(--border); }
        .primary-btn { background: var(--google-blue); color: #fff; border: none; font-weight: bold; cursor: pointer; }
        #map { width: 100%; height: 200px; border-radius: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<div class="sidebar" id="sidebar">
    <h2 style="color:var(--google-blue); margin-top:0;">Management</h2>
    <div id="map"></div>
    
    <input id="sName" placeholder="Student Name">
    <input id="sPrice" type="number" placeholder="Fee (SR)">
    
    <div class="palette" id="colorPalette"></div>
    <button class="primary-btn" onclick="addStudent()">Add Student</button>

    <hr style="border:0; border-top:1px solid var(--border); margin:20px 0;">
    <select id="sSelect"></select>
    <input type="time" id="cTime">
    <select id="cDay">
        <option value="Sat">Saturday</option><option value="Sun">Sunday</option>
        <option value="Mon">Monday</option><option value="Tue">Tuesday</option>
        <option value="Wed">Wednesday</option><option value="Thu">Thursday</option>
    </select>
    <button class="primary-btn" style="background:var(--google-green)" onclick="addSchedule()">Save Session</button>
    <div id="paymentList" style="margin-top:20px;"></div>
</div>

<div class="main-content">
    <header>
        <div class="logo-container">
            <span class="c1">S</span><span class="c2">m</span><span class="c3">a</span><span class="c4">r</span><span class="c5">t</span>
            <div class="space"></div>
            <span class="c6">T</span><span class="c7">u</span><span class="c8">t</span><span class="c9">o</span><span class="c10">r</span>
        </div>
        <button onclick="toggleMenu()" style="background:#fff; border:1px solid var(--border); padding:8px 15px; border-radius:20px;">Menu ☰</button>
    </header>
    <div class="time-grid" id="mainGrid"></div>
</div>

<script>
    const colors = ["#4285F4", "#EA4335", "#FBBC05", "#34A853", "#673AB7", "#E91E63", "#00BCD4", "#FF5722"];
    let selectedColor = colors[0];
    let students = JSON.parse(localStorage.getItem('smart_tutor_v3')) || [];

    function initPalette() {
        const p = document.getElementById('colorPalette');
        colors.forEach(c => {
            const div = document.createElement('div');
            div.className = 'color-swatch' + (c === selectedColor ? ' active' : '');
            div.style.background = c;
            div.onclick = () => {
                selectedColor = c;
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                div.classList.add('active');
            };
            p.appendChild(div);
        });
    }

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('overlay').classList.toggle('active');
    }

    function addStudent() {
        let name = document.getElementById('sName').value;
        let price = document.getElementById('sPrice').value;
        if(!name || !price) return;
        students.push({
            id: Date.now(), name, price, color: selectedColor, isPaid: false,
            lat: 25.3833 + (Math.random()*0.04-0.02), lng: 49.5833 + (Math.random()*0.04-0.02),
            schedules: []
        });
        save();
        document.getElementById('sName').value = ""; document.getElementById('sPrice').value = "";
    }

    function addSchedule() {
        let id = +document.getElementById('sSelect').value;
        let time = document.getElementById('cTime').value;
        let day = document.getElementById('cDay').value;
        if(!id || !time) return;
        students.find(s => s.id === id).schedules.push({day, time});
        save();
        toggleMenu();
    }

    function togglePay(id) {
        let s = students.find(s => s.id === id);
        s.isPaid = !s.isPaid;
        save();
    }

    function save() {
        localStorage.setItem('smart_tutor_v3', JSON.stringify(students));
        render();
    }

    function render() {
        const grid = document.getElementById('mainGrid');
        const select = document.getElementById('sSelect');
        const pList = document.getElementById('paymentList');
        grid.innerHTML = ''; select.innerHTML = '<option value="">Select Student</option>'; pList.innerHTML = '';
        const days = {Sat:"SAT", Sun:"SUN", Mon:"MON", Tue:"TUE", Wed:"WED", Thu:"THU"};

        Object.keys(days).forEach(d => {
            grid.innerHTML += `<div class="day-row row-${d.toLowerCase()}"><div class="day-label">${days[d]}</div><div class="slots" id="slot-${d}"></div></div>`;
        });

        students.forEach(s => {
            select.innerHTML += `<option value="${s.id}">${s.name}</option>`;
            pList.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:8px; padding:10px; border:1px solid #eee; border-radius:10px;"><span>${s.name} (${s.price} SR)</span><button onclick="togglePay(${s.id})" style="width:auto; margin:0; padding:5px 10px; background:${s.isPaid?'#34A853':'#EA4335'}; color:#fff; border:none; border-radius:5px;">${s.isPaid?'Paid':'Pay'}</button></div>`;
            
            s.schedules.forEach(sc => {
                const box = document.getElementById(`slot-${sc.day}`);
                if(box) box.innerHTML += `<div class="slot" style="background:${s.color}"><b>${sc.time}</b><span>${s.name}</span></div>`;
            });
        });
    }

    let map = L.map('map').setView([25.3833, 49.5833], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    initPalette();
    render();
</script>
</body>
</html>
