<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Tutor Pro | Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --bg-dark:#09090b; --card-bg:#141417; --accent:#6366f1;
            --text-main:#fafafa; --border:#27272a; --green:#10b981;
        }
        body { margin:0; background:var(--bg-dark); color:var(--text-main); font-family:system-ui, sans-serif; }
        .container { width:100%; max-width:480px; margin:auto; padding:15px; box-sizing:border-box; }
        
        .card { background:var(--card-bg); border:1px solid var(--border); border-radius:20px; padding:15px; margin-bottom:15px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        #map { width: 100%; height: 350px; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 10px; z-index: 1; }
        
        /* ØªØµÙ…ÙŠÙ… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        .student-marker {
            width: 40px; height: 40px;
            border-radius: 50%;
            border: 2px solid var(--accent);
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            object-fit: cover;
        }

        input, select, button { width:100%; padding:12px; margin-bottom:10px; border-radius:12px; border:1px solid var(--border); background:#000; color:#fff; }
        button { cursor:pointer; font-weight:700; border:none; background:var(--accent); }
        
        .student-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: #1c1c20; border-radius: 15px; margin-bottom: 5px; }
        .student-item img { width: 35px; height: 35px; border-radius: 50%; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align:center; padding:10px;">
        <h1 style="background:linear-gradient(to right,#818cf8,#c084fc); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin:0;">Smart Tutor Map</h1>
    </header>

    <section class="card">
        <h3 style="color:var(--accent); margin-top:0;">ğŸ“ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­ÙŠØ©</h3>
        <div id="map"></div>
        <p style="font-size:10px; color:#aaa; text-align:center;">* Ø§Ù„ØµÙˆØ± ØªØ¸Ù‡Ø± ÙÙˆÙ‚ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</p>
    </section>

    <section class="card">
        <h3>ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ ÙˆÙ…ÙˆÙ‚Ø¹Ù‡</h3>
        <div style="text-align:center; margin-bottom:10px;">
            <input type="file" id="pic" hidden onchange="loadFile(event)">
            <img id="tempImg" src="https://via.placeholder.com/60" style="width:60px; height:60px; border-radius:50%; cursor:pointer;" onclick="document.getElementById('pic').click()">
        </div>
        <input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
        <input id="lat" placeholder="Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
        <input id="lng" placeholder="Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
        <p style="font-size:10px; color:var(--green)">Ù†ØµÙŠØ­Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ù† Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„ ÙˆÙ„ØµÙ‚Ù‡Ø§ Ù‡Ù†Ø§.</p>
        <button onclick="addStudent()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø®Ø±ÙŠØ·Ø©</button>
    </section>

    <section class="card">
        <h3>ğŸ‘¥ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
        <div id="list"></div>
    </section>
</div>

<script>
    let map = L.map('map').setView([25.3833, 49.5833], 13); // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ù‡ÙÙˆÙ
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let students = JSON.parse(localStorage.getItem('map_tutor_v1')) || [];
    let currentImg = "";

    function loadFile(event) {
        let reader = new FileReader();
        reader.onload = () => {
            currentImg = reader.result;
            document.getElementById('tempImg').src = currentImg;
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function addStudent() {
        let name = document.getElementById('name').value;
        let lat = parseFloat(document.getElementById('lat').value) || 25.3833 + (Math.random() * 0.02);
        let lng = parseFloat(document.getElementById('lng').value) || 49.5833 + (Math.random() * 0.02);
        
        let newStudent = { name, lat, lng, img: currentImg || 'https://via.placeholder.com/40' };
        students.push(newStudent);
        localStorage.setItem('map_tutor_v1', JSON.stringify(students));
        
        render();
    }

    function render() {
        document.getElementById('list').innerHTML = "";
        // Ù…Ø³Ø­ Ø§Ù„Ù…Ø§Ø±ÙƒØ±Ø² Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        map.eachLayer((layer) => { if (layer instanceof L.Marker) map.removeLayer(layer); });

        students.forEach(s => {
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            let customIcon = L.divIcon({
                html: `<img src="${s.img}" class="student-marker">`,
                className: '',
                iconSize: [40, 40],
                iconAnchor: [20, 40]
            });

            L.marker([s.lat, s.lng], {icon: customIcon}).addTo(map).bindPopup(s.name);

            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
            document.getElementById('list').innerHTML += `
                <div class="student-item">
                    <img src="${s.img}">
                    <span>${s.name}</span>
                </div>
            `;
        });
    }

    render();
</script>
</body>
</html>
